<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Corso SP 2017</title>
		<meta name="author" value="Marco Ferrante, marco@csita.unige.it">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
	<!--
Cosa vi serve:
- Mozilla Firefox (va bene anche Google Chrome, ma gli esempi fanno riferimento a FF)
- PHP
https://github.com/janschoepke/reveal_external

Istruzioni per VM

dev'essere attivo e disponibile SSL/https

	-->
<div class="reveal"><div class="slides">

<section><h1>Sviluppo di servizi SSO SAML 2.0</h1>
<p>Marco Ferrante (Università di Genova)</p>
<p>Giuliano Latini (Università Politecnica delle Marche)</p>
<p>membri CTS GARR IDEM</p>
	<aside class="notes">
Ringraziamenti: Davide Vaghetti (UniPi)
	</aside>
			</section>
			
				<!-- parte 1 -->
			<section><h1>Web Single SignOn</h1>
<p>Il Single SignOn (SSO) consente ad un utente di effettuare un'unica autenticazione (authN) valida per più risorse</p>
<p>Non si occupa dell’autorizzazione (authZ), di solito in capo alla risorsa</p>
	<aside class="notes">
	Benefits of using single sign-on include:
Mitigate risk for access to 3rd-party sites (user passwords not stored or managed externally)
Reduce password fatigue from different user name and password combinations
Reduce time spent re-entering passwords for the same identity
Reduce IT costs due to lower number of IT help desk calls about passwords
	</aside>
			</section>
			
			<section>
<p>L'utente si autentica presso un <i>autorità</i> (IdP, <i title="terminologia OpenID Connect, derivato da OAuth">Authorization Server</i>, ....) e ottiene un <i>token</i> (o <i>ticket</i>)<p>
<p>L'utente poi presenta il <i>token</i> alle risorse (SP, <i title="terminologia OpenID Connect, derivato da OAuth">client</i>, ...) che lo valideranno e lo valuteranno per l'autorizzazione</p>
			</section>
			
			<section>
				<!-- parte 2 -->

		<section><h2>Singole applicazioni web</h2>
		<p>il <i>token</i> è un cookie che identifica la sessione nell’applicazione</p>
			<aside class="notes">
I cookie vengono trasmessi solo al dominio specificato nell’attributo domain, a cui deve appartenere il server host
			</aside>
		</section>

		<section><h2>Domain o intra-organizational SSO</h2>
		<p>il <i>token</i> è un cookie di dominio che identifica la sessione sull'authN server</p>
		<p>tipicamente un <i>back-channel</i> trasferisce i dati di sessione tra authN server e risorsa</p>
		<p>Esempi: <a href="https://apereo.github.io/cas/5.1.x/protocol/CAS-Protocol.html">CAS</a>,
			<a href="http://weblogin.org/">CoSign</a>,
			<a href="http://www.pubcookie.org/" title="Il dominio sembra scaduto a luglio">Pubcookie</a></p>
		</section>
				
	</section>

	<section>
			
	<section><h2>Autenticazione federata</h2>
	<p>il <i>token</i> è un pacchetto XML (asserzione) legato alla sessione sull'authN server</p>
	<p>l'asserzione viene scambiata, di solito via <i>front-channel</i>, con l'applicazione che genera una sessione locale</p> 
	</section>

	<section><h2>Shibboleth vs. SAML</h2>
	<p>SAML è uno standard OASIS</p>
	<p><a href="https://www.shibboleth.net">Shibboleth</a> è l'implementazione
	di riferimento di SAML, ma ne esistono altre:
	SimpleSAMLphp, Microsoft ADFS, OneLogin, Google,
	<a href="https://dev.entrouvert.org/projects/authentic" title="IdP e SP, basato su Python, francese">Authentic 2</a>,
	<a href="http://www.josso.org" title="IdP e SP e librerie, commerciale e community">JOSSO</a>,
	PingFederate</p>
	<p>Tratteremo solo SAML 2.0</p>

	<table class="biblio" style="font-size: small"><tr><td>Riferimenti</td><td><a href="https://en.wikipedia.org/wiki/SAML-based_products_and_services">https://en.wikipedia.org/wiki/SAML-based_products_and_services</a>
		</td></tr></table>		
	
	<aside class="notes">
	Standard: insieme di protocolli, formati, interazioni, ecc...
	
	The Organization for the Advancement of Structured Information Standards (OASIS) is a global nonprofit consortium that works on the development, convergence, and adoption of standards for security, Internet of Things, energy, content technologies, emergency management, and other areas.
	
	Compatibilità: Kantara Initiative
	
	
	</aside>		
	</section>
				
	<section><h2>Protocollo SAML 2.0</h2>
	Agli inizi degli anni 2000, furono sviluppate diverse proposte di protocolli e implementazioni per autenticazione federata
	<ul>
	<li><b>Shibboleth 1.x</b> da parte del progetto Internet 2</li>
	<li><b>SAML 1.0</b> OASIS Security Services Technical Committee</li>
	<li><b>Liberty Identity Federation </b> consorzio Liberty Alliance</li>
	</ul>
	Nel 2005 sono confluite nello standard OASIS SAML 2.0
	</section>

				<section><h2>SAML 2.0 per SSO</h2>
				
				<table>
					<tr><td>
				<p>Adottare SAML 2.0 per il SSO intra-organizzativo è un driver per l'autenticazione federata</p>
				<p>SAML 2.0 permette di integrare servizi di terzi</p>
					</td><td>
					IdP UniGe maggio 2017
					
<table class="tableview" style="font-size: small;"><tbody><tr><th class="value">Value</th><th class="category">Data range</th></tr><tr class="total odd"><td class="value">391025</td><td class="category">All services</td></tr><tr class="even"><td class="value">252979</td><td class="category">AulaWeb, servizio e-learning</td></tr><tr class="odd"><td class="value">119428</td><td class="category">https://servizionline.unige.it/</td></tr><tr class="even"><td class="value">3132</td><td class="category">Servizio di hosting UniGE</td></tr><tr class="odd"><td class="value">2302</td><td class="category">READY - SAL</td></tr><tr class="even"><td class="value">1917</td><td class="category">SciuMegu <span style="color: yellow">&lsaquo;&lsaquo;&lsaquo;&lsaquo;&lsaquo;&lsaquo;</span></td></tr><tr class="odd"><td class="value">1916</td><td class="category">https://moodle3.aulaweb.unige.it/</td></tr><tr class="even"><td class="value">1550</td><td class="category">Servizi online UniGE</td></tr><tr class="odd"><td class="value">1470</td><td class="category">https://unigepass.unige.it/sp</td></tr><tr class="even"><td class="value">996</td><td class="category">Siti federati UniGE</td></tr><tr class="odd"><td class="value">872</td><td class="category">Siti di servizio UniGE</td></tr><tr class="even"><td class="value">846</td><td class="category" >Elsevier ScienceDirect <span style="color: yellow">&lsaquo;&lsaquo;&lsaquo;&lsaquo;&lsaquo;&lsaquo;</span></td></tr><tr class="odd"><td class="value">801</td><td class="category">https://esami.aulaweb.unige.it/sp</td></tr><tr class="even"><td class="value">765</td><td class="category">https://ssounige.sbgnet.it/shibboleth</td></tr><tr class="odd"><td class="value">497</td><td class="category">eduOpen MOOC Italy</td></tr><tr class="even"><td class="value">238</td><td class="category">Thomson Reuters</td></tr><tr class="odd"><td class="value">173</td><td class="category">Servizio di liste UniGe</td></tr><tr class="even"><td class="value">169</td><td class="category">Sito DICCA</td></tr><tr class="odd"><td class="value">121</td><td class="category">SheerID Verification Services</td></tr><tr class="even"><td class="value">92</td><td class="category">FileSender GARR</td></tr><tr class="odd"><td class="value">85</td><td class="category">DreamSpark, e-academy WebStore erogato da e-academy, Inc</td></tr><tr class="even"><td class="value">78</td><td class="category">IEEE XploreDigital Library provided by IEEE</td></tr><tr class="odd"><td class="value">78</td><td class="category">UNiDAYS</td></tr><tr class="even"><td class="value">67</td><td class="category">Incassi On Line</td></tr><tr class="odd"><td class="value">67</td><td class="category">Nilde Utenti erogato da Biblio Area CNR Bologna</td></tr><tr class="even"><td class="value">45</td><td class="category">Compilatio - Prévention du plagiat</td></tr><tr class="odd"><td class="value">32</td><td class="category">Siti web Dipartimento di Fisica (DIFI)</td></tr><tr class="even"><td class="value">30</td><td class="category">https://intranet.unige.it/sp</td></tr><tr class="odd"><td class="value">28</td><td class="category">WiFi UniTO erogato da Università degli Studi di Torino</td></tr><tr class="even"><td class="value">25</td><td class="category">SpringerLink by Springer-Verlag London, Ltd.</td></tr><tr class="odd"><td class="value">23</td><td class="category">https://vm-fad2.ker.csita.unige.it/</td></tr><tr class="even"><td class="value">22</td><td class="category">Società editrice il Mulino SP</td></tr><tr class="odd"><td class="value">19</td><td class="category">Nature Publishing Group journals</td></tr><tr class="even"><td class="value">19</td><td class="category">Semantico Limited - OUP Shibboleth 2 SP</td></tr><tr class="odd"><td class="value">17</td><td class="category">Atypon SP</td></tr><tr class="even"><td class="value">14</td><td class="category">ProQuest</td></tr><tr class="odd"><td class="value">12</td><td class="category">ORCID</td></tr><tr class="even"><td class="value">12</td><td class="category">https://esami.aulaweb.unige.it/shibboleth</td></tr><tr class="odd"><td class="value">12</td><td class="category">OVID SP</td></tr><tr class="even"><td class="value">10</td><td class="category">Cambridge Journals Online</td></tr><tr class="odd"><td class="value">9</td><td class="category">Elearning U-GOV</td></tr><tr class="even"><td class="value">8</td><td class="category">Student Beans</td></tr><tr class="odd"><td class="value">7</td><td class="category">Sito Web IDEM - https://www.idem.garr.it</td></tr><tr class="even"><td class="value">7</td><td class="category">ACS Publications</td></tr><tr class="odd"><td class="value">6</td><td class="category">http://servizionline.unige.it</td></tr><tr class="even"><td class="value">5</td><td class="category">RSC Publishing</td></tr><tr class="odd"><td class="value">5</td><td class="category">Bestr - Piattaforma Open Badge</td></tr><tr class="even"><td class="value">4</td><td class="category">Annual Reviews</td></tr><tr class="odd"><td class="value">4</td><td class="category">Project MUSE provided by The Johns Hopkins University Press</td></tr><tr class="even"><td class="value">3</td><td class="category">Foodle</td></tr><tr class="odd"><td class="value">2</td><td class="category">ACM Digital Library provided by ACM</td></tr><tr class="even"><td class="value">2</td><td class="category">Università di Genova</td></tr><tr class="odd"><td class="value">1</td><td class="category">Learning GARR</td></tr><tr class="even"><td class="value">1</td><td class="category">GÉANT Trusted Certificate Service (TCS)</td></tr><tr class="odd"><td class="value">1</td><td class="category">https://moodle-esterni.aulaweb.unige.it/</td></tr><tr class="even"><td class="value">1</td><td class="category">https://aulaweb.unige.it/test31</td></tr></tbody></table>
				
					</td></tr>
					</table>
					<aside class="notes">
Per così pochi accessi federati, non varrebbe la pena...
					</aside>
				</section>

	<section><h2>Ruoli</h2>

	<dl style="columns: 2;">
	<dt>Subject</dt>
	<dd></dd>
	<dt>Relying party</dt>
	<dd style="break-before: avoid;">un sistema che riceve e trasmette informazioni SAML<br>
	<dt>Service Provider (SP)</dt>
	<dd style="break-before: avoid;">permette l'acceso ad una risorsa<br>
	<small>gestito dal fornitore del servizio</small></dd>
	<dt>Identity Provider (IdP)</dt>
	<dd style="break-before: avoid;">fornisce un <i>token</i> all'utente<br>
	<small>gestito dalla <i>home organization</i></small></dd>
	<dt>Attribute Autority (AA)</dt>
	<dd style="break-before: avoid;">rilascia attributi sull'utente<br >
	<small>spesso coincide con l'IdP</small></dd>
	<dt>WAYF o Discovery</dt>
	<dd style="break-before: avoid;">media tra il SP e l'utente per identificare l'IdP di riferimento<br>
	<small>integrato nel servizio o gestito dalla federazione</small></dd>
	</section>

	<section><h2>Profili</h2>
	<p>Ogni componente fornisce dei <i>servizi</i></p>
	<aside class="notes">
	Esempio: servizio di consumo di asserzioni sull'SP (AssertionConsumerService),
	servizio di Single Logout su IdP e SP (Single Logout Service), ecc...
	</aside>
	<p>I servizi sono caratterizzati da</p>
	<ul>
	<li><i>Binding</i> il protocollo (SOAP, POST, ecc...)</li>
	<li><i>Location</i> endpoint del servizio (tipicamente un URL)
	</ul>
	<p>Uno schema di servizi e binding è detto <i>profilo</i></p>
	<aside class="notes">
	Qui tratteremo approfonditamente solo il Web Browser SSO Profile
	</aside>
	</section>

	<section id="es1"><h2>Comunicazioni</h2>
	<p>Le comunicazioni passano dal <i>front-channel</i></p>
	<p>Sincronizzare gli orologi :-) tra SP e IdP</p>
	<p>L'utente vede i messaggi: si possono firmare e cifrare</p>
	<aside class="notes">
	Le comunicazioni passano dal browser utente. Eccezioni: ECP profile (server-server)
	5 minuti di tolleranza tipica
	</aside>		
	<p><a href="tracking.html">Esercizio 1</a></p>
	<aside class="notes">
	Simulazione a condizione che si disponga della chiave private (e degli altri metadati) dell'SP
	Occorre eseguire l'editor (notepad) come amministratore
	</aside>
	</section>

				
	<section><h2>Profili</h2>
	<p>Un <i>profilo</i> specifica come un'applicazione usa i protocolli, i messaggi e i binding SAML</p>
	Web Browser SSO Profile
	Binding sul back channel: possibili usi
	ECP profile
	<aside class="notes">
	https://www.cse.wustl.edu/~jain/cse571-07/ftp/websso/index.html
	</aside>
	</section>

	<section id="SAML2Int"><h2>SAML2Int</h2>
	<p>Il <a href="http://saml2int.org/">Interoperable SAML 2.0 Profile</a> (SAML2Int)
	è una raccomandazione di comportamenti e opzioni per il deploy di un servizio
	SAML 2.0 WebSSO Deployment Profile con il massimo dell'interoperabilità</p>
		
			<aside class="notes">
Ci limitiamo a questo... 
Supportato da Feide (Norvegia), Haka (Finlandia), eduGAIN (Geant), RedIRIS (Spagna), e altre RENs
https://saml2int.org/partners/
			</aside>
		</section>

	<section><h2>Web Browser SSO Profile</h2>
<script type="https://www.websequencediagrams.com">
title Web Browser SSO Profile

participant utente (UA) as UA
participant Service Provider as SP1
participant IdP as IdP

UA->SP1: voglio collegarmi!
alt discovery integrato/IdP fisso
    SP1->SP1: DS
else federazione
    SP1->WAYF: WAYF
    WAYF-->SP1: IdP SSOService
end
SP1-->UA: redirect to IdP <AuthnRequest>
UA->IdP: <AuthnRequest>
IdP-->UA: login form
UA->IdP: username/password
IdP-->UA: form <SAMLResponse>
UA->SP1: POST to SP ACS <SAMLResponse>
note left of SP1: login dalla\nsessione locale
SP1->UA: fatto!
</script>
<iframe width="900" height="400" srcdoc="<img src='diagramma-sso.png'>"></iframe>
	</section>
				
	<section><h2>*-first</h2>
	<dl>
		<dt>IdP-first/-initiated</dt>
		<dd>l'UA accede all'IdP con un eventuale parametro tipo spentityId</dd>
		<dd>l'IdP rimanda all'SP all'URL o al SP specificato</dd>
		<dt>SP-first/-initiated</dt>
		<dd>il SP redirige all'IdP con un messaggio di <tt>AuthnRequest</tt></dd>
		<dd>l'IdP rimanda all'SP con una token contenente un'asserzione</dd>
	</dl>

	<aside class="notes">
SAML V1.1 protocol was inherently an IdP-first protocol, Shibboleth
invented a simple HTTP-based authentication request protocol
that turned SAML V1.1 into an SP-first protocol
	</aside>
	</section>
				
	<section><h2>Asserzioni</h2>
	<p>Un pacchetto XML che dice "in un certo istante questo IdP asserisce che per un determinato soggetto valgono questi attributi"</p>
	<ol>
		<li>Issuer: entityId che ha rilasciato l'asserzione</li>
		<li>firme e chiavi</li>
		<li>Subject: l'oggetto dell'asserzione</li>
		<li>Conditions: condizioni di validità dell'asserzione</li>
		<li>AuthnStatement: le circostanze di autenticazione</li>
		<li>AttributeStatement: elenco degli attributi del soggetto</li>
	</ol>
	</section>

	<section><h2>Issuer</h2>
<pre><code data-trim data-noescape>
&lt;saml:Assertion
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	<mark>ID</mark>="_d5a64ffca10a1098db9e83ee90a9a696f6dfb5d48f"
	<mark>Version="2.0"</mark>
	<mark>IssueInstant</mark>="2017-09-20T07:10:21Z"&gt;
  &lt;saml:Issuer&gt;<mark>https://unigepass.unige.it/idp</mark>&lt;/saml:Issuer&gt;
</code></pre>
	</section>

	<section><h2>Firme e chiavi</h2>
<pre><code data-trim data-noescape>
&lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
  &lt;ds:SignedInfo&gt;
    &lt;ds:CanonicalizationMethod
		Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"...
  &lt;/ds:SignedInfo&gt;
  &lt;ds:SignatureValue
	iaw9oFF4A9LNcpk8isjnexUh...
  &lt;ds:KeyInfo&gt;
    &lt;ds:X509Data&gt;
	 &lt;ds:X509Certificate>MIIDXjCCAkYCCQD...
</code></pre>
	</section>

	<section><h2>Subject</h2>
<pre><code data-trim data-noescape>
&lt;saml:Subject&gt;
  &lt;saml:NameID
      <mark>SPNameQualifier</mark>="https://vm-fad2.ker.csita.unige.it/"
	  <mark>Format="urn:oasis:names:tc:SAML:2.0:nameid-format:transient</mark>"&gt;&#8617;
		 _ca04214ebdb2c...d
	  &lt;/saml:NameID&gt;
	&lt;saml:SubjectConfirmation
	    <mark>Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"</mark>&gt;
	  &lt;saml:SubjectConfirmationData
	    <mark>NotOnOrAfter="2017-09-20T07:15:21Z"</mark>
		<mark>Recipient</mark>="https://valutazione2.aulaweb.unige.it/simplesaml/&#8617;
		    module.php/saml/sp/saml2-acs.php/UniGePASS"
		<mark>InResponseTo</mark>="_1596ffb37ce5..."/&gt;
</code></pre>
	</section>	

	<section><h2>NameID</h2>
	Identificativo del soggetto
	<dl>
	<dt>urn:oasis:names:tc:SAML:1.1:nameid-format:<mark>unspecified</mark></dt>
	<dd>l'interpretazione è un accordo tra IdP e SP</dd>
	<dt>urn:oasis:names:tc:SAML:1.1:nameid-format:<mark>emailAddress</mark></dt>
	<dd>ovvio</dd>
	<dt>urn:oasis:names:tc:SAML:2.0:nameid-format:<mark>persistent</mark></dt>
	<dd>persistente tra sessioni, opaco, differente da SP e SP</dd>
	<dt>urn:oasis:names:tc:SAML:2.0:nameid-format:<mark>transient</mark></dt>
	<dd>di sessione, opaco e differente da SP e SP</dd>
	</dl>
	
	<table class="biblio" style="font-size: small"><tr><td>Riferimenti</td><td><a href="https://wiki.shibboleth.net/confluence/display/CONCEPT/NameIdentifiers">https://wiki.shibboleth.net/confluence/display/CONCEPT/NameIdentifiers</a>
		</td></tr></table>	
	</section>
					
	<section><h2>NameID e attributi</h2>
	Le installazioni tipiche Shibboleth e di federazioni RENs usano un attributo per
	identificare il soggetto. Esempi:
	eppn
	</section>

	
	<section><h2>Conditions</h2>
<pre><code data-trim data-noescape>
&lt;saml:Conditions
    NotBefore="2017-09-20T07:09:51Z"
	NotOnOrAfter="2017-09-20T07:15:21Z"&gt;
  &lt;saml:AudienceRestriction&gt;
    &lt;saml:Audience&gt;https://vm-fad2.ker.csita.unige.it/&lt;/saml:Audience&gt;
</code></pre>
	</section>	

	<section><h2>AuthnStatement</h2>
<pre><code data-trim data-noescape>
&lt;saml:AuthnStatement
    AuthnInstant="2017-09-20T07:09:12Z"
	SessionNotOnOrAfter="2017-09-20T15:09:12Z"
	SessionIndex="_5b594bc61778598703b25364ce8e53f10ad1d203f4"&gt;
  &lt;saml:AuthnContext&gt;
    &lt;saml:AuthnContextClassRef&gt;&#8617;
	urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport&#8617;
	&lt;/saml:AuthnContextClassRef&gt;
</code></pre>
	</section>	

	<section><h2>AttributeStatement</h2>
<pre><code data-trim data-noescape>
&lt;saml:AttributeStatement&gt;
  &lt;saml:Attribute FriendlyName="mail"
      Name="urn:oid:0.9.2342.19200300.100.1.3"
	  NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:uri"&gt;
    ...
  &lt;/saml:Attribute&gt;
  &lt;saml:Attribute ...>
  &lt;/saml:Attribute&gt;
  &lt;saml:Attribute ...>
  ...
</code></pre>
	</section>	

	<section><h2>Attribute</h2>
<pre><code data-trim data-noescape>
  &lt;saml:Attribute FriendlyName="mail"
      Name="urn:oid:0.9.2342.19200300.100.1.3"
      NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:uri"&gt;
    &lt;saml:AttributeValue xsi:type="xs:string"&gt;&#8617;
	    marco@csita.unige.it&lt;/saml:AttributeValue&gt;
    &lt;saml:AttributeValue xsi:type="xs:string"&gt;&#8617;
	    ferrante@csita.unige.it&lt;/saml:AttributeValue&gt;
</code></pre>
	</section>	

	<section><h2>NameFormat</h2>
	<dl>
	<dt>urn:oasis:names:tc:SAML:2.0:attrname-format:<mark>uri</mark></dt>
	<dd>OID LDAP o URN mace: o URL</dd>
	<dt>urn:oasis:names:tc:SAML:2.0:attrname-format:<mark>unspecified</mark></dt>
	<dd>come dice il nome...</dd>
	<dt>urn:oasis:names:tc:SAML:2.0:attrname-format:<mark>basic</mark></dt>
	<dd>nomi LDAP</dd>
	</dl>
	</section>
					
	
	<section id="slo"><h2>Single Logout (SLO)</h2>
	Passando dal <i>front-channel</i> e adattando la maggior parte delle applicazioni le sessioni locali al SSO, il Single Logout è controintuitivo per gli utenti:
	<ul>
		<li>si disconnette da un servizio e, se va tutto bene, si trova disconnesso da tutti</li>
		<li>oppure ritrova con una sessione <i>zombie</i> locale</li>
		<li>oppure riceve un errore da un servizio che non ricorda di aver aperto</li>
		<li>o altro ancora...</li>
	</ul>
	L'unico meccanismo di SLO affidabile è la chiusura del browser
	<aside class="notes">
Una sessione zombie "risorge" facendo back dal browser o simili...
La maggior parte dei servizi a cui è abituato (Amazon, Facebook, ecc...) sono sempre connessi, quindi la mancanza di logout non è più insolita
https://www.switch.ch/aai/support/presentations/sp-training-2014/T6-1-Logout-Support-SP.pdf
	</aside>	
	</section>
	
	<section><h2>Single Logout (SLO)</h2>
<script type="https://www.websequencediagrams.com">
title Single Logout

participant utente (UA) as UA
participant SP 1 as SP1
participant IdP as IdP
participant SP 2 as SP2
participant SP ... as more
participant SP n as SPn

UA->SP1: voglio scollegarmi!
note left of UA: dal bottone di logout
SP1-->UA: redirect to IdP <LogoutRequest>
UA->IdP: <LogoutRequest>
IdP-->UA: redirect to SP 2 <LogoutRequest>
UA->SP2: <LogoutRequest>
SP2-->UA: redirect to IdP <LogoutResponse>
UA->IdP: <LogoutResponse>
IdP-->UA: redirect to SP n <LogoutRequest>
UA->SPn: <LogoutRequest>
SPn-->UA: redirect to IdP <LogoutResponse>
UA->IdP: <LogoutResponse>
IdP-->UA: redirect to SP 1 <LogoutRequest>
note left of SP1: logout dalla\nsessione locale
SP1->UA: fatto!
</script>
<iframe width="900" height="400" srcdoc="<img src='diagramma-slo.png'>"></iframe>
	
	</section>

	<section><h2>Errore Partial Logout</h2>
	</section>
	
</section>

<section>
	<!-- parte 3, il Service Provider -->
	
	<section><h2>Il Service Provider</h2>
	<p>Controlla gli accessi ad una risorsa consumando asserzioni fornite da un IdP</p>
	
	A SAML service provider is a system entity that receives and accepts authentication assertions in conjunction with a single sign-on (SSO) profile of the Security Assertion Markup Language (SAML).
In the SAML domain model, a SAML relying party is any system entity that receives and accepts information from another system entity.[OS 1] Of particular interest is a SAML relying party that receives and accepts a SAML assertion issued by a SAML authority.
An important type of SAML authority is the SAML identity provider, a system entity that issues authentication assertions in conjunction with an SSO profile of SAML.[OS 2] A relying party that consumes such assertions is called a SAML service provider (or simply service provider if the domain is understood). Thus a SAML service provider is a system entity that receives and accepts an authentication assertion issued by a SAML identity provider.</p>

	<aside class="notes">
	</aside>
	</section>

	<section><h2>Metadati</h2>
	<p>Come fanno IdP e SP a "conoscersi"? Si scambiano i <i>metadati</i></p>
	<ul>
		<li>ogni attore è identificato da un <i>EntityID</i> (un URI nel namespace dell'organizzazione) 
		<li>informazioni di contorno per l'utente (nome del servizio, contatti, loghi, ecc...)</li>
		<li>chiavi crittografiche (pubbliche :-) e loro uso</li>
		<li>il formato di nomi supportato (NameIDFormat)
		<li>per IdP: binding e location dei servizi supportati SSO, SLO, Artifact Resolution, AA, ecc...</li>
		<li>per SP: binding e location dei servizi supportati ACS, SLO, Artifact Resolution, ecc...</li>
	</ul>
	Lo standard di interscambio è XML
		<aside class="notes">
		</aside>
	</section>

	<section><h2>Esempi metadati</h2>
	<!-- per formattare:
	https://support.mozilla.org/it/questions/1016939
	-->
	<a href="idp-univpm.xml" target="_blank">IdP Università Politecnica delle Marche</a>
	<a href="sp-wiki-idem.xml" target="_blank">SP Wiki IDEM</a>
	</section>
	
	<section><h2>Metadati</h2>
	<p>Come gestirli</p>
		<aside class="notes">
		</aside>
	</section>

	<section><h2>Metadati</h2>
	<p>Come scambiarli</p>
		<aside class="notes">
		</aside>
	</section>

</section>
			
			<section>
				<!-- parte 5 -->
				
				<section><h2>Discovery</h2>
				La fase di discovery/WAYF
				<p>Servizio locale/servizio centralizzato</p>
				</section>

				<section><h2>Metadati</h2>
				<p>Identificatori utente scoped</p>
				</section>

			</section>
			
			<section>
				<!-- parte 6 -->
				
				<section id="container"><h2>Autenticazione gestita dal container/web server</h2>
				<p></p>


				</section>

				<section id="shibboleth"><h2>Shibboleth Native Service Provider (SP)</h2>
				<p>Linux+Apache</p>
				<p>Microsoft Windows server+IIS (o Apache)</p>
				<a href="shibboleth.html">Esempio Shibboleth SP</a>


				</section>
				
				<section><h2>Alternativa: mod_auth_mellon</h2>
				<p>Un modulo Apache con un semplice SAML 2.0 service provider
https://github.com/UNINETT/mod_auth_mellon
Sviluppato da REN norvegese</p>
				</section>

				<section><h2>Alternativa: mod_auth_memcookie</h2>
				<p>Mooolto diverso, non è neanche una vera alternativa ma spiega il concetto
				
				https://zenprojects.github.io/Apache-Authmemcookie-Module/
Un modulo di SimpleSAMLphp inizializza una sessione per Auth MemCookie				
</p>
				</section>

			</section>			

			<section>
				<!-- parte 7 -->
				
				<section><h2>Autenticazione gestita dalle applicazioni/librerie</h2>
				</section>

				<section id="ssp"><h2>SimpleSAMLphp</h2>
				<p><a href="https://simplesamlphp.org/">SimpleSAMLphp</a> (SSP) è una libreria PHP sviluppata dalla REN norvegese UNINETT</p>
				<ul>
					<li>opensource</li>
					<li>funzionalità di IdP e SP</li>
					<li>non richiede interventi a livello di sistema (quasi...)</li>
					<li>supporta SAML 2.0, Shibboleth 1.3, A-Select, CAS, OpenID, WS-Federation, OAuth, ecc...</li>
				</ul>
				<a href="ssp.html">Esempio SSP</a>
				<aside class="notes">
				Ne sappiamo qualcosa:
				https://github.com/simplesamlphp/simplesamlphp/blob/master/lib/SimpleSAML/Utils/HTTP.php
				attorno a linea 460
				https://github.com/simplesamlphp/simplesamlphp/commits?author=biancini
				</aside>
				</section>
				
				<section><h2>Alternative: Onelogin</h2>
				<p></p>
				</section>

				<section><h2>Alternative: pysaml2</h2>
				<p></p>
				</section>

				<section><h2>Alternative: Java</h2>
				<p></p>
				</section>

			</section>

			<section>
				<!-- parte 8 -->
				
				<section><h2>Servizi cloud</h2>
				</section>

				<section><h2>Auth0</h2>
				<p></p>
				</section>
			</section>

			<section>
				<!-- parte 9 -->
				
				<section><h2>Linee guida siti con autenticazione federata</h2>
				</section>

				<section><h2></h2>
				<p>Slide di Lalla...</p>
				</section>
			</section>
				
			<section>
				<!-- parte 10 -->
				
				<section><h2>Spid</h2>
				</section>

			</section>
				
			</div>
			
		</div>
<!--
IdP fornito da GARR
Virtual box
1 debug lato browser
1 esercizio su Shibboleth
	- configurazione
	- pagina di status
	- reverse proxy
	- logout
1 esercizio su PHP
	- lazy session

-->

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
					width: "80%",
					height: "100%",
					margin: 0,
					minScale: 1,
					maxScale: 1,
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/menu/menu.js' }
				]
			});
		</script>
	</body>
</html>
